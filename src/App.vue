<script setup>
import SideBar from "@/components/SideBar.vue";
import MainWindow from "@/components/MainWindow.vue";
import StatusBar from "@/components/StatusBar.vue";
import MenuBar from "@/components/MenuBar.vue";
import SettingWindow from "@/components/SettingWindow.vue";
</script>

<template>
  <menu-bar/>
  <div class="frame">
    <div class="loading-mask">
      <div class="program-loading"></div>
      <div class="loading-bottom"></div>
    </div>
    <side-bar ref="side-bar"/>
    <main-window ref="main-window"/>
    <setting-window ref="setting-window"/>
  </div>
  <status-bar/>
</template>

<script>
import '@/assets/css/app.css';

import $ from 'jquery';

const ipcRenderer = window.require('electron').ipcRenderer;

let isRun = false
let loadingLoop

export default {
  name: 'App',
  mounted() {
    this.insertWave()
    this.processing()
    ipcRenderer.on('go-setting', (event, isShow) => {
      if (isRun !== false) {
        // show setting here
        if (isShow) {
          this.$refs["main-window"].hide()
          this.$refs["setting-window"].show()
        } else {
          this.$refs["main-window"].show()
          this.$refs["setting-window"].hide()
        }
        console.log(isShow)
      }
    })
    let runLoop = setInterval(() => {
      isRun = ipcRenderer.sendSync('window-run')
      if (isRun) {
        clearInterval(runLoop)
        this.removeAllLoading()

        this.$refs["setting-window"].hide()
        this.$refs["side-bar"].run()
        this.$refs["main-window"].run()
      }
    }, 200)
  },
  methods: {
    processing() {
      let baseText = 'Program is loading, please wait'
      let loading = $('.program-loading')
      loading.html(baseText)
      loading.html(baseText).css('opacity', 1)
      let current = 0
      loadingLoop = setInterval(() => {
        if (current === 0) {
          $('.program-loading').html(baseText)
          current++
        } else if (current === 1) {
          $('.program-loading').html(baseText + '.')
          current++
        } else if (current === 2) {
          $('.program-loading').html(baseText + '..')
          current++
        } else if (current === 3) {
          $('.program-loading').html(baseText + '...')
          current = 0
        }
      }, 500)
    },
    insertWave() {
      $('.loading-bottom').html('<svg width="100%" height="100%" id="svg" viewBox="0 0 1440 590" xmlns="http://www.w3.org/2000/svg" class="transition duration-300 ease-in-out delay-150"><style>\n' +
          '          .path-0{\n' +
          '            animation:pathAnim-0 4s;\n' +
          '            animation-timing-function: linear;\n' +
          '            animation-iteration-count: infinite;\n' +
          '          }\n' +
          '          @keyframes pathAnim-0{\n' +
          '            0%{\n' +
          '              d: path("M 0,600 C 0,600 0,200 0,200 C 102.6794258373206,223.08133971291866 205.3588516746412,246.16267942583733 313,232 C 420.6411483253588,217.83732057416267 533.2440191387559,166.4306220095694 610,151 C 686.7559808612441,135.5693779904306 727.665071770335,156.11483253588514 813,186 C 898.334928229665,215.88516746411486 1028.0956937799042,255.11004784688998 1140,259 C 1251.9043062200958,262.88995215311 1345.952153110048,231.444976076555 1440,200 C 1440,200 1440,600 1440,600 Z");\n' +
          '            }\n' +
          '            25%{\n' +
          '              d: path("M 0,600 C 0,600 0,200 0,200 C 104.02870813397132,217.51196172248802 208.05741626794264,235.02392344497608 314,223 C 419.94258373205736,210.97607655502392 527.7990430622009,169.41626794258374 629,162 C 730.2009569377991,154.58373205741626 824.7464114832536,181.311004784689 906,209 C 987.2535885167464,236.688995215311 1055.2153110047846,265.33971291866027 1142,264 C 1228.7846889952154,262.66028708133973 1334.3923444976076,231.33014354066987 1440,200 C 1440,200 1440,600 1440,600 Z");\n' +
          '            }\n' +
          '            50%{\n' +
          '              d: path("M 0,600 C 0,600 0,200 0,200 C 81.96172248803828,224.8421052631579 163.92344497607655,249.68421052631578 266,238 C 368.07655502392345,226.31578947368422 490.26794258373207,178.10526315789474 584,153 C 677.7320574162679,127.89473684210525 743.0047846889953,125.89473684210526 845,144 C 946.9952153110047,162.10526315789474 1085.712918660287,200.31578947368422 1191,213 C 1296.287081339713,225.68421052631578 1368.1435406698565,212.8421052631579 1440,200 C 1440,200 1440,600 1440,600 Z");\n' +
          '            }\n' +
          '            75%{\n' +
          '              d: path("M 0,600 C 0,600 0,200 0,200 C 79.02392344497608,225.10047846889952 158.04784688995215,250.20095693779905 269,234 C 379.95215311004785,217.79904306220095 522.8325358851674,160.29665071770333 623,156 C 723.1674641148326,151.70334928229667 780.622009569378,200.6124401913876 860,213 C 939.377990430622,225.3875598086124 1040.6794258373207,201.25358851674642 1141,193 C 1241.3205741626793,184.74641148325358 1340.6602870813397,192.3732057416268 1440,200 C 1440,200 1440,600 1440,600 Z");\n' +
          '            }\n' +
          '            100%{\n' +
          '              d: path("M 0,600 C 0,600 0,200 0,200 C 102.6794258373206,223.08133971291866 205.3588516746412,246.16267942583733 313,232 C 420.6411483253588,217.83732057416267 533.2440191387559,166.4306220095694 610,151 C 686.7559808612441,135.5693779904306 727.665071770335,156.11483253588514 813,186 C 898.334928229665,215.88516746411486 1028.0956937799042,255.11004784688998 1140,259 C 1251.9043062200958,262.88995215311 1345.952153110048,231.444976076555 1440,200 C 1440,200 1440,600 1440,600 Z");\n' +
          '            }\n' +
          '          }</style><defs><linearGradient id="gradient" x1="0%" y1="50%" x2="100%" y2="50%"><stop offset="5%" stop-color="#F78DA7"></stop><stop offset="95%" stop-color="#8ED1FC"></stop></linearGradient></defs><path d="M 0,600 C 0,600 0,200 0,200 C 102.6794258373206,223.08133971291866 205.3588516746412,246.16267942583733 313,232 C 420.6411483253588,217.83732057416267 533.2440191387559,166.4306220095694 610,151 C 686.7559808612441,135.5693779904306 727.665071770335,156.11483253588514 813,186 C 898.334928229665,215.88516746411486 1028.0956937799042,255.11004784688998 1140,259 C 1251.9043062200958,262.88995215311 1345.952153110048,231.444976076555 1440,200 C 1440,200 1440,600 1440,600 Z" stroke="none" stroke-width="0" fill="url(#gradient)" fill-opacity="0.53" class="transition-all duration-300 ease-in-out delay-150 path-0"></path><style>\n' +
          '          .path-1{\n' +
          '            animation:pathAnim-1 4s;\n' +
          '            animation-timing-function: linear;\n' +
          '            animation-iteration-count: infinite;\n' +
          '          }\n' +
          '          @keyframes pathAnim-1{\n' +
          '            0%{\n' +
          '              d: path("M 0,600 C 0,600 0,400 0,400 C 82.3732057416268,367.2918660287081 164.7464114832536,334.5837320574163 270,350 C 375.2535885167464,365.4162679425837 503.3875598086124,428.9569377990431 605,464 C 706.6124401913876,499.0430622009569 781.7033492822966,505.58851674641147 869,471 C 956.2966507177034,436.41148325358853 1055.799043062201,360.68899521531097 1153,342 C 1250.200956937799,323.31100478468903 1345.1004784688994,361.6555023923445 1440,400 C 1440,400 1440,600 1440,600 Z");\n' +
          '            }\n' +
          '            25%{\n' +
          '              d: path("M 0,600 C 0,600 0,400 0,400 C 98.68899521531102,426.96650717703346 197.37799043062205,453.933014354067 291,451 C 384.62200956937795,448.066985645933 473.17703349282294,415.23444976076553 562,404 C 650.8229665071771,392.76555023923447 739.9138755980863,403.12918660287085 843,389 C 946.0861244019137,374.87081339712915 1063.1674641148325,336.2488038277512 1165,334 C 1266.8325358851675,331.7511961722488 1353.4162679425838,365.8755980861244 1440,400 C 1440,400 1440,600 1440,600 Z");\n' +
          '            }\n' +
          '            50%{\n' +
          '              d: path("M 0,600 C 0,600 0,400 0,400 C 99.01435406698565,429.311004784689 198.0287081339713,458.62200956937795 293,448 C 387.9712918660287,437.37799043062205 478.8995215311004,386.82296650717706 570,368 C 661.1004784688996,349.17703349282294 752.3732057416269,362.0861244019138 850,375 C 947.6267942583731,387.9138755980862 1051.6076555023924,400.8325358851675 1151,405 C 1250.3923444976076,409.1674641148325 1345.1961722488038,404.5837320574162 1440,400 C 1440,400 1440,600 1440,600 Z");\n' +
          '            }\n' +
          '            75%{\n' +
          '              d: path("M 0,600 C 0,600 0,400 0,400 C 80.35406698564591,373.52153110047846 160.70813397129183,347.04306220095697 242,335 C 323.29186602870817,322.95693779904303 405.52153110047857,325.34928229665076 524,333 C 642.4784688995214,340.65071770334924 797.2057416267942,353.5598086124402 895,380 C 992.7942583732058,406.4401913875598 1033.6555023923447,446.4114832535886 1115,452 C 1196.3444976076553,457.5885167464114 1318.1722488038276,428.7942583732057 1440,400 C 1440,400 1440,600 1440,600 Z");\n' +
          '            }\n' +
          '            100%{\n' +
          '              d: path("M 0,600 C 0,600 0,400 0,400 C 82.3732057416268,367.2918660287081 164.7464114832536,334.5837320574163 270,350 C 375.2535885167464,365.4162679425837 503.3875598086124,428.9569377990431 605,464 C 706.6124401913876,499.0430622009569 781.7033492822966,505.58851674641147 869,471 C 956.2966507177034,436.41148325358853 1055.799043062201,360.68899521531097 1153,342 C 1250.200956937799,323.31100478468903 1345.1004784688994,361.6555023923445 1440,400 C 1440,400 1440,600 1440,600 Z");\n' +
          '            }\n' +
          '          }</style><defs><linearGradient id="gradient" x1="0%" y1="50%" x2="100%" y2="50%"><stop offset="5%" stop-color="#F78DA7"></stop><stop offset="95%" stop-color="#8ED1FC"></stop></linearGradient></defs><path d="M 0,600 C 0,600 0,400 0,400 C 82.3732057416268,367.2918660287081 164.7464114832536,334.5837320574163 270,350 C 375.2535885167464,365.4162679425837 503.3875598086124,428.9569377990431 605,464 C 706.6124401913876,499.0430622009569 781.7033492822966,505.58851674641147 869,471 C 956.2966507177034,436.41148325358853 1055.799043062201,360.68899521531097 1153,342 C 1250.200956937799,323.31100478468903 1345.1004784688994,361.6555023923445 1440,400 C 1440,400 1440,600 1440,600 Z" stroke="none" stroke-width="0" fill="url(#gradient)" fill-opacity="1" class="transition-all duration-300 ease-in-out delay-150 path-1"></path></svg>')

    },
    removeAllLoading() {
      let mask = $('.loading-mask')
      mask.css('opacity', 0)
      mask.css('z-index', -999)
      try {
        clearInterval(loadingLoop)
      } catch (err) {
        console.log(err)
      }
      $('.program-loading').html('')
      $('.loading-bottom').html('')
    }
  }
}
</script>

